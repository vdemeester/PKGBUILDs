# Maintainer: Vincent Demeester <vincent@sbr.io>
# Contributor: Sizhao LIU <sizhaoliu@talend.com>

pkgname="talend-open-studio-bd"
_altname="Talend Open Studio for Big Data"
_shortname="TOS_BD"
_altshortname="tos"
pkgver="5.3.1"
_build="r104014"
pkgrel=1
pkgdesc="Open-source Big Data software from Talend."
arch=('i686' 'x86_64')
url=("http://www.talend.com")
license=("GPL2")
depends=("gtk2" "glib2")
options=("!strip")

# Choose your prefered site, default value is US.
_hostsite=("http://talend.dreamhosters.com") # US server
#_hostsite=("http://download-mirror1.talend.com") # Europe server
# http://talend.dreamhosters.com/tosbd/release/V5.3.1/TOS_BD-r104014-V5.3.1.zip
source=("${_hostsite}/tosbd/release/V${pkgver}/${_shortname}-${_build}-V${pkgver}.zip" 
	"${_shortname// /}.desktop")
md5sums=("a0ee44c742592011fc7b810edc4fd3a9"
	"09335b2e46fcd527e11d64d8416e2342")

build(){
	
    install -dm755 ${pkgdir}/opt ${pkgdir}/usr/bin ${pkgdir}/usr/share/applications || return 1    
    
    # Remove all non-Linux startup scripts   
    cd ${srcdir}/${_shortname}-${_build}-V${pkgver} &&
    rm -rf  *macosx* *solaris* *gtk-ppc* *win* || return 1
  
    cp -Rp ${srcdir}/${_shortname}-${_build}-V${pkgver} ${pkgdir}/opt/${_shortname}-${_build}-V${pkgver} || return 1

    # Link application icon
    ln -s /opt/${_shortname}-${_build}-V${pkgver}/plugins/org.talend.rcp.branding.${_altshortname}_${pkgver}.${_build}/icons/appli_32x32.gif ${pkgdir}/opt/${_shortname}-${_build}-V${pkgver}/icon.gif

    # Link executable based on architecture
    install -m 0755 ${srcdir}/${_shortname// /}.desktop ${pkgdir}/usr/share/applications/ || return 1
    
    ln -s /opt/${_shortname}-${_build}-V${pkgver}/${_shortname// /}-linux-gtk-${CARCH//i6/x} ${pkgdir}/usr/bin/${pkgname} || return 1
    chmod +x ${pkgdir}/opt/${_shortname}-${_build}-V${pkgver}/${_shortname// /}-linux-gtk-${CARCH//i6/x} || return 1      
  }
